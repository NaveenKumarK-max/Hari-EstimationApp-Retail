/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter } from '@angular/core';
import DEFAULTS from './misc/defaults';
import { EMOJIS } from './misc/emojis.data';
import { EMOS } from './misc/emos.data';
export class NgxEmojComponent {
    constructor() {
        this.DEFAULTS = DEFAULTS;
        this.onemojipick = new EventEmitter;
        this.onchardelete = new EventEmitter;
        // Initially  apply default config...
        this.theme = {};
        this.emojiCategories = [];
        // list of emos type, e.g emoji, gifs, stickers...
        this.emos = [];
        this.hideFooter = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // Set recent emoji store key...
        this.emojiDBKey = this.recentEmojiStoreKey || DEFAULTS.recentEmojiStoreKey;
        // Get recent emojis..
        this.emojiDB = window.localStorage.getItem(this.emojiDBKey);
        if (this.emojiDB) {
            this.emojiDB = JSON.parse(this.emojiDB);
        }
        else {
            // no stored recent emoji, save in the store array ...
            this.emojiDB = [];
            window.localStorage.setItem(this.emojiDBKey, JSON.stringify(this.emojiDB));
        }
        this.activeCategory = 'People';
        // get the emoji categories
        this.emojiCategories = EMOJIS.map((value) => {
            return { name: value.name, icon: value.icon };
        });
        // filter to set defaults
        this.activeEmojiSet = EMOJIS.filter((category) => {
            if (category.name === this.activeCategory) {
                return category;
            }
        });
        this.activeIndex = this.activeEmojiSet[0].id;
        // console.log('Initial Emo Index:', this.activeIndex);
        this.activeEmojiSet = this.activeEmojiSet[0].emojis;
        this.activeEmo = 'Emoji';
        // collate the emos type
        this.emos = EMOS.map((value) => {
            return { name: value.name, icon: value.icon };
        });
    }
    /**
     * @param {?} e
     * @return {?}
     */
    handleCategoryChange(e) {
        // set active category name...
        this.activeCategory = e.name;
        if (e.name === 'Recent') {
            // If recent category, set emoji to emojis in the recent store...
            this.activeIndex = EMOJIS[1].id;
            this.activeEmojiSet = this.emojiDB;
        }
        else if (e.name === 'Search') {
            this.activeIndex = EMOJIS[0].id;
            this.activeEmojiSet = this.emojiDB.concat(EMOJIS[2].emojis);
        }
        else {
            // filter to set current emoji set...
            this.activeEmojiSet = EMOJIS.filter((category) => {
                if (category.name === this.activeCategory) {
                    return category;
                }
            });
            // update the index on manual change...
            this.activeIndex = this.activeEmojiSet[0].id;
            this.activeEmojiSet = this.activeEmojiSet[0].emojis;
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    handleEmoChange(e) {
        this.activeEmo = e.name;
        // collate the emos type
        //   this.emos = EMOS.map((value) => {
        //    return {name: value.name, icon: value.icon};
        //  });
    }
    /**
     * @param {?} name
     * @return {?}
     */
    checkIfEmojiExistsInEmojiDB(name) {
        /** @type {?} */
        let emo_exists = false;
        // checks if emoji is already in recent emoji db store...
        for (let i = 0; i < this.emojiDB.length; i++) {
            if (this.emojiDB[i][1] === name) {
                emo_exists = true;
                break;
            }
        }
        return emo_exists;
    }
    /**
     * @param {?} emoji
     * @return {?}
     */
    addEmojiToRecentEmojiDB(emoji) {
        // check if there is no duplicate
        if (!this.checkIfEmojiExistsInEmojiDB(emoji[1])) {
            // recent emoji greater than the number of max, remove the first emoji and add new one
            // to the back...
            if (this.emojiDB.length < (this.maxRecentEmoji || DEFAULTS.maxRecentEmoji)) {
                this.emojiDB.push(emoji);
                window.localStorage.setItem(this.emojiDBKey, JSON.stringify(this.emojiDB));
            }
            else {
                this.emojiDB.splice(0, 1);
                this.emojiDB.push(emoji);
                window.localStorage.setItem(this.emojiDBKey, JSON.stringify(this.emojiDB));
            }
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    handleEmojiPick(e) {
        // save the picked emoji inside recent emoji DB
        this.addEmojiToRecentEmojiDB(e.emoji);
        this.onemojipick.emit({ char: e.emoji[0], name: e.emoji[1] });
    }
    /**
     * @param {?} e
     * @return {?}
     */
    handleCharDelete(e) {
        this.onchardelete.emit({ deleteChar: true });
    }
    /**
     * @param {?} e
     * @return {?}
     */
    handleContentScroll(e) {
        // console.log('emitted', e.scrollTop, e.scrollHeight);
        if ((e.scrollHeight - e.scrollTop) <= 400) {
            // console.log('almost at the end');
            this.hideFooter = true;
        }
        else {
            // console.log('tooping the scroll');
            this.hideFooter = false;
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    handleContentSwipe(e) {
        /** @type {?} */
        const currentIndex = this.activeIndex;
        /** @type {?} */
        const direction = e.direction;
        // Log the necessary details...
        if (direction === 'left') {
            /** @type {?} */
            const prev = currentIndex - 1;
            if (prev >= 0) {
                if (prev === 0) {
                    // search
                    this.activeIndex = EMOJIS[0].id;
                    this.activeCategory = EMOJIS[0].name;
                    this.activeEmojiSet = this.emojiDB.concat(EMOJIS[2].emojis);
                }
                else if (prev === 1) {
                    // recent
                    this.activeIndex = EMOJIS[1].id;
                    this.activeCategory = EMOJIS[1].name;
                    this.activeEmojiSet = this.emojiDB;
                }
                else {
                    /** @type {?} */
                    const prevCategoryData = EMOJIS.filter((category) => {
                        if (category.id === prev) {
                            return category;
                        }
                    });
                    // set the values...
                    this.activeIndex = prev;
                    this.activeCategory = prevCategoryData[0].name;
                    this.activeEmojiSet = prevCategoryData[0].emojis;
                }
            }
        }
        else if (direction === 'right') {
            /** @type {?} */
            const next = currentIndex + 1;
            if (next === 0) {
                // search
                this.activeIndex = EMOJIS[0].id;
                this.activeCategory = EMOJIS[0].name;
                this.activeEmojiSet = this.emojiDB.concat(EMOJIS[2].emojis);
            }
            else if (next === 1) {
                // recent
                this.activeIndex = EMOJIS[1].id;
                this.activeEmojiSet = this.emojiDB;
                this.activeCategory = EMOJIS[1].name;
            }
            else {
                if (next <= (EMOJIS.length - 1)) {
                    /** @type {?} */
                    const prevCategoryData = EMOJIS.filter((category) => {
                        if (category.id === next) {
                            return category;
                        }
                    });
                    // set the values...
                    this.activeIndex = next;
                    this.activeCategory = prevCategoryData[0].name;
                    this.activeEmojiSet = prevCategoryData[0].emojis;
                }
            }
        }
    }
}
NgxEmojComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-emoj',
                template: `
    <div class="ngx-emoji-mart"
      [ngStyle]="
      {'background-color': (theme.martBG || DEFAULTS.martBG),
       'width': (width || DEFAULTS.martWidth),
       'height': (height || DEFAULTS.martHeight),
       'font-family': (theme.martFontFamily || DEFAULTS.martFontFamily),
       'border-radius': (theme.martBorderRadius || DEFAULTS.martBorderRadius)}">
      <ngx-emoj-header
        *ngIf="theme.martShowHeader"
        [headerBG]="(theme.martHeaderBG || DEFAULTS.martHeaderBG)"
        [headerFG]="(theme.martHeaderFG || DEFAULTS.martHeaderFG)"
        [headerFontSize]="(theme.martHeaderFontSize || DEFAULTS.martHeaderFontSize)"
        [headerPadding]="(theme.martHeaderPadding || DEFAULTS.martHeaderPadding)"
        [defaultActiveCategory]="'People'"
        [activeCategory]="activeCategory"
        (oncategorychange)="handleCategoryChange($event)"
        [martCategoryFontSize]="(theme.martCategoryFontSize || DEFAULTS.martCategoryFontSize)"
        [martCategoryColor]="(theme.martCategoryColor || DEFAULTS.martCategoryColor)"
        [martCategoryColorActive]="(theme.martCategoryColorActive || DEFAULTS.martCategoryColorActive)"
        [activeIndicatorColor]="(theme.martActiveCategoryIndicatorColor || DEFAULTS.martActiveCategoryIndicatorColor)"
        [activeIndicatorHeight]="(theme.martActiveCategoryIndicatorHeight || DEFAULTS.martActiveCategoryIndicatorHeight)"
        [emojiCategories]="emojiCategories">
      </ngx-emoj-header>

      <ngx-emoj-category-content
      [categoryName]="activeCategory"
      [categoryEmojiSet]="activeEmojiSet"
      [activeIndex]="activeIndex"
      [martEmojiNotFoundFG]="(theme.martEmojiNotFoundFG || DEFAULTS.martEmojiNotFoundFG)"
      [emojiNotFoundText]="(emojiNotFoundText || DEFAULTS.emojiNotFoundText)"
      [searchBoxStyle]="(theme.martSearchBoxStyle || DEFAULTS.martSearchBoxStyle)"
      [searchEmojiPlaceholderText]="(searchEmojiPlaceholderText || DEFAULTS.searchEmojiPlaceholderText)"
      [emojiBtnPadding]="(theme.martEmojiPadding || DEFAULTS.martEmojiPadding)"
      [emojiFontSize]="(theme.martEmojiFontSize || DEFAULTS.martEmojiFontSize)"
      (onpickemoji)="handleEmojiPick($event)"
      (oncontentSwipe)="handleContentSwipe($event)"
      (oncontentscroll)="handleContentScroll($event)">
      </ngx-emoj-category-content>
      <ngx-emoj-footer
      *ngIf="theme.martShowFooter"
      [footerBG]="(theme.martFooterBG || DEFAULTS.martFooterBG)"
      [footerFG]="(theme.martFooterFG || DEFAULTS.martFooterFG)"
      [footerFontSize]="(theme.martFooterFontSize || DEFAULTS.martFooterFontSize)"
      [footerPadding]="(theme.martFooterPadding || DEFAULTS.martFooterPadding)"
      [defaultActiveEmo]="'Emoji'"
      (onchardelete)="handleCharDelete($event)"
      (onemochange)="handleEmoChange($event)"
      [martCategoryFontSize]="(theme.martCategoryFontSize || DEFAULTS.martCategoryFontSize)"
      [martCategoryColor]="(theme.martCategoryColor || DEFAULTS.martCategoryColor)"
      [martCategoryColorActive]="(theme.martCategoryColorActive || DEFAULTS.martCategoryColorActive)"
      [activeIndicatorColor]="(theme.martActiveCategoryIndicatorColor || DEFAULTS.martActiveCategoryIndicatorColor)"
      [activeIndicatorHeight]="(theme.martActiveCategoryIndicatorHeight || DEFAULTS.martActiveCategoryIndicatorHeight)"
      [emos]="emos"
      [hideFooter]="hideFooter">
    </ngx-emoj-footer>

    </div>
  `,
                styles: [`

    .ngx-emoji-mart
    {
      position: relative;
      margin: 0;
      margin-bottom: 10px;
      padding: 0px;
      box-sizing: border-box;
      overflow: hidden;
    }
  `]
            }] }
];
/** @nocollapse */
NgxEmojComponent.ctorParameters = () => [];
NgxEmojComponent.propDecorators = {
    width: [{ type: Input }],
    height: [{ type: Input }],
    onemojipick: [{ type: Output }],
    onchardelete: [{ type: Output }],
    theme: [{ type: Input }],
    maxRecentEmoji: [{ type: Input }],
    recentEmojiStoreKey: [{ type: Input }],
    searchEmojiPlaceholderText: [{ type: Input }],
    emojiNotFoundText: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NgxEmojComponent.prototype.DEFAULTS;
    /** @type {?} */
    NgxEmojComponent.prototype.width;
    /** @type {?} */
    NgxEmojComponent.prototype.height;
    /** @type {?} */
    NgxEmojComponent.prototype.onemojipick;
    /** @type {?} */
    NgxEmojComponent.prototype.onchardelete;
    /** @type {?} */
    NgxEmojComponent.prototype.theme;
    /** @type {?} */
    NgxEmojComponent.prototype.emojiCategories;
    /** @type {?} */
    NgxEmojComponent.prototype.emos;
    /** @type {?} */
    NgxEmojComponent.prototype.activeCategory;
    /** @type {?} */
    NgxEmojComponent.prototype.activeEmo;
    /** @type {?} */
    NgxEmojComponent.prototype.activeIndex;
    /** @type {?} */
    NgxEmojComponent.prototype.activeEmojiSet;
    /** @type {?} */
    NgxEmojComponent.prototype.hideFooter;
    /** @type {?} */
    NgxEmojComponent.prototype.maxRecentEmoji;
    /** @type {?} */
    NgxEmojComponent.prototype.recentEmojiStoreKey;
    /** @type {?} */
    NgxEmojComponent.prototype.searchEmojiPlaceholderText;
    /** @type {?} */
    NgxEmojComponent.prototype.emojiNotFoundText;
    /** @type {?} */
    NgxEmojComponent.prototype.emojiDB;
    /** @type {?} */
    NgxEmojComponent.prototype.emojiDBKey;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWVtb2ouY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWVtb2ovIiwic291cmNlcyI6WyJsaWIvbmd4LWVtb2ouY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRy9FLE9BQU8sUUFBUSxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFnRnhDLE1BQU0sT0FBTyxnQkFBZ0I7SUFnQzNCO1FBOUJTLGFBQVEsR0FBRyxRQUFRLENBQUM7UUFJbkIsZ0JBQVcsR0FBUSxJQUFJLFlBQVksQ0FBQztRQUNwQyxpQkFBWSxHQUFRLElBQUksWUFBWSxDQUFDOztRQUl0QyxVQUFLLEdBQVUsRUFBRSxDQUFDO1FBRTNCLG9CQUFlLEdBQVUsRUFBRSxDQUFDOztRQUc1QixTQUFJLEdBQVcsRUFBRSxDQUFDO1FBS2xCLGVBQVUsR0FBWSxLQUFLLENBQUM7SUFZNUIsQ0FBQzs7OztJQUVELFFBQVE7UUFFTixnQ0FBZ0M7UUFDaEMsSUFBSSxDQUFDLFVBQVUsR0FBSSxJQUFJLENBQUMsbUJBQW1CLElBQUksUUFBUSxDQUFDLG1CQUFtQixDQUFDO1FBQzVFLHNCQUFzQjtRQUN0QixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM1RCxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDbEIsSUFBSSxDQUFDLE9BQU8sR0FBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN4QzthQUFNO1lBQ0wsc0RBQXNEO1lBQ3RELElBQUksQ0FBQyxP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LFVBQVU7Z0JBQ3BCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTBEVDt5QkFDUTs7Ozs7Ozs7Ozs7R0FXUjthQUNGOzs7OztvQkFPRSxLQUFLO3FCQUNMLEtBQUs7MEJBQ0wsTUFBTTsyQkFDTixNQUFNO29CQUlOLEtBQUs7NkJBYUwsS0FBSztrQ0FDTCxLQUFLO3lDQUNMLEtBQUs7Z0NBQ0wsS0FBSzs7OztJQXpCTixvQ0FBNkI7O0lBRTdCLGlDQUF1Qjs7SUFDdkIsa0NBQXdCOztJQUN4Qix1Q0FBOEM7O0lBQzlDLHdDQUErQzs7SUFJL0MsaUNBQTJCOztJQUUzQiwyQ0FBNEI7O0lBRzVCLGdDQUFrQjs7SUFDbEIsMENBQXVCOztJQUN2QixxQ0FBa0I7O0lBQ2xCLHVDQUFvQjs7SUFDcEIsMENBQXNCOztJQUN0QixzQ0FBNEI7O0lBRzVCLDBDQUFnQzs7SUFDaEMsK0NBQXFDOztJQUNyQyxzREFBNEM7O0lBQzVDLDZDQUFtQzs7SUFFbkMsbUNBQWE7O0lBQ2Isc0NBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgVGhlbWUgZnJvbSAnLi9pbnRlcmZhY2VzL1RoZW1lJztcbmltcG9ydCBERUZBVUxUUyBmcm9tICcuL21pc2MvZGVmYXVsdHMnO1xuaW1wb3J0IHsgRU1PSklTIH0gZnJvbSAnLi9taXNjL2Vtb2ppcy5kYXRhJztcbmltcG9ydCB7IEVNT1MgfSBmcm9tICcuL21pc2MvZW1vcy5kYXRhJztcblxuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1lbW9qJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwibmd4LWVtb2ppLW1hcnRcIlxuICAgICAgW25nU3R5bGVdPVwiXG4gICAgICB7J2JhY2tncm91bmQtY29sb3InOiAodGhlbWUubWFydEJHIHx8IERFRkFVTFRTLm1hcnRCRyksXG4gICAgICAgJ3dpZHRoJzogKHdpZHRoIHx8IERFRkFVTFRTLm1hcnRXaWR0aCksXG4gICAgICAgJ2hlaWdodCc6IChoZWlnaHQgfHwgREVGQVVMVFMubWFydEhlaWdodCksXG4gICAgICAgJ2ZvbnQtZmFtaWx5JzogKHRoZW1lLm1hcnRGb250RmFtaWx5IHx8IERFRkFVTFRTLm1hcnRGb250RmFtaWx5KSxcbiAgICAgICAnYm9yZGVyLXJhZGl1cyc6ICh0aGVtZS5tYXJ0Qm9yZGVyUmFkaXVzIHx8IERFRkFVTFRTLm1hcnRCb3JkZXJSYWRpdXMpfVwiPlxuICAgICAgPG5neC1lbW9qLWhlYWRlclxuICAgICAgICAqbmdJZj1cInRoZW1lLm1hcnRTaG93SGVhZGVyXCJcbiAgICAgICAgW2hlYWRlckJHXT1cIih0aGVtZS5tYXJ0SGVhZGVyQkcgfHwgREVGQVVMVFMubWFydEhlYWRlckJHKVwiXG4gICAgICAgIFtoZWFkZXJGR109XCIodGhlbWUubWFydEhlYWRlckZHIHx8IERFRkFVTFRTLm1hcnRIZWFkZXJGRylcIlxuICAgICAgICBbaGVhZGVyRm9udFNpemVdPVwiKHRoZW1lLm1hcnRIZWFkZXJGb250U2l6ZSB8fCBERUZBVUxUUy5tYXJ0SGVhZGVyRm9udFNpemUpXCJcbiAgICAgICAgW2hlYWRlclBhZGRpbmddPVwiKHRoZW1lLm1hcnRIZWFkZXJQYWRkaW5nIHx8IERFRkFVTFRTLm1hcnRIZWFkZXJQYWRkaW5nKVwiXG4gICAgICAgIFtkZWZhdWx0QWN0aXZlQ2F0ZWdvcnldPVwiJ1Blb3BsZSdcIlxuICAgICAgICBbYWN0aXZlQ2F0ZWdvcnldPVwiYWN0aXZlQ2F0ZWdvcnlcIlxuICAgICAgICAob25jYXRlZ29yeWNoYW5nZSk9XCJoYW5kbGVDYXRlZ29yeUNoYW5nZSgkZXZlbnQpXCJcbiAgICAgICAgW21hcnRDYXRlZ29yeUZvbnRTaXplXT1cIih0aGVtZS5tYXJ0Q2F0ZWdvcnlGb250U2l6ZSB8fCBERUZBVUxUUy5tYXJ0Q2F0ZWdvcnlGb250U2l6ZSlcIlxuICAgICAgICBbbWFydENhdGVnb3J5Q29sb3JdPVwiKHRoZW1lLm1hcnRDYXRlZ29yeUNvbG9yIHx8IERFRkFVTFRTLm1hcnRDYXRlZ29yeUNvbG9yKVwiXG4gICAgICAgIFttYXJ0Q2F0ZWdvcnlDb2xvckFjdGl2ZV09XCIodGhlbWUubWFydENhdGVnb3J5Q29sb3JBY3RpdmUgfHwgREVGQVVMVFMubWFydENhdGVnb3J5Q29sb3JBY3RpdmUpXCJcbiAgICAgICAgW2FjdGl2ZUluZGljYXRvckNvbG9yXT1cIih0aGVtZS5tYXJ0QWN0aXZlQ2F0ZWdvcnlJbmRpY2F0b3JDb2xvciB8fCBERUZBVUxUUy5tYXJ0QWN0aXZlQ2F0ZWdvcnlJbmRpY2F0b3JDb2xvcilcIlxuICAgICAgICBbYWN0aXZlSW5kaWNhdG9ySGVpZ2h0XT1cIih0aGVtZS5tYXJ0QWN0aXZlQ2F0ZWdvcnlJbmRpY2F0b3JIZWlnaHQgfHwgREVGQVVMVFMubWFydEFjdGl2ZUNhdGVnb3J5SW5kaWNhdG9ySGVpZ2h0KVwiXG4gICAgICAgIFtlbW9qaUNhdGVnb3JpZXNdPVwiZW1vamlDYXRlZ29yaWVzXCI+XG4gICAgICA8L25neC1lbW9qLWhlYWRlcj5cblxuICAgICAgPG5neC1lbW9qLWNhdGVnb3J5LWNvbnRlbnRcbiAgICAgIFtjYXRlZ29yeU5hbWVdPVwiYWN0aXZlQ2F0ZWdvcnlcIlxuICAgICAgW2NhdGVnb3J5RW1vamlTZXRdPVwiYWN0aXZlRW1vamlTZXRcIlxuICAgICAgW2FjdGl2ZUluZGV4XT1cImFjdGl2ZUluZGV4XCJcbiAgICAgIFttYXJ0RW1vamlOb3RGb3VuZEZHXT1cIih0aGVtZS5tYXJ0RW1vamlOb3RGb3VuZEZHIHx8IERFRkFVTFRTLm1hcnRFbW9qaU5vdEZvdW5kRkcpXCJcbiAgICAgIFtlbW9qaU5vdEZvdW5kVGV4dF09XCIoZW1vamlOb3RGb3VuZFRleHQgfHwgREVGQVVMVFMuZW1vamlOb3RGb3VuZFRleHQpXCJcbiAgICAgIFtzZWFyY2hCb3hTdHlsZV09XCIodGhlbWUubWFydFNlYXJjaEJveFN0eWxlIHx8IERFRkFVTFRTLm1hcnRTZWFyY2hCb3hTdHlsZSlcIlxuICAgICAgW3NlYXJjaEVtb2ppUGxhY2Vob2xkZXJUZXh0XT1cIihzZWFyY2hFbW9qaVBsYWNlaG9sZGVyVGV4dCB8fCBERUZBVUxUUy5zZWFyY2hFbW9qaVBsYWNlaG9sZGVyVGV4dClcIlxuICAgICAgW2Vtb2ppQnRuUGFkZGluZ109XCIodGhlbWUubWFydEVtb2ppUGFkZGluZyB8fCBERUZBVUxUUy5tYXJ0RW1vamlQYWRkaW5nKVwiXG4gICAgICBbZW1vamlGb250U2l6ZV09XCIodGhlbWUubWFydEVtb2ppRm9udFNpemUgfHwgREVGQVVMVFMubWFydEVtb2ppRm9udFNpemUpXCJcbiAgICAgIChvbnBpY2tlbW9qaSk9XCJoYW5kbGVFbW9qaVBpY2soJGV2ZW50KVwiXG4gICAgICAob25jb250ZW50U3dpcGUpPVwiaGFuZGxlQ29udGVudFN3aXBlKCRldmVudClcIlxuICAgICAgKG9uY29udGVudHNjcm9sbCk9XCJoYW5kbGVDb250ZW50U2Nyb2xsKCRldmVudClcIj5cbiAgICAgIDwvbmd4LWVtb2otY2F0ZWdvcnktY29udGVudD5cbiAgICAgIDxuZ3gtZW1vai1mb290ZXJcbiAgICAgICpuZ0lmPVwidGhlbWUubWFydFNob3dGb290ZXJcIlxuICAgICAgW2Zvb3RlckJHXT1cIih0aGVtZS5tYXJ0Rm9vdGVyQkcgfHwgREVGQVVMVFMubWFydEZvb3RlckJHKVwiXG4gICAgICBbZm9vdGVyRkddPVwiKHRoZW1lLm1hcnRGb290ZXJGRyB8fCBERUZBVUxUUy5tYXJ0Rm9vdGVyRkcpXCJcbiAgICAgIFtmb290ZXJGb250U2l6ZV09XCIodGhlbWUubWFydEZvb3RlckZvbnRTaXplIHx8IERFRkFVTFRTLm1hcnRGb290ZXJGb250U2l6ZSlcIlxuICAgICAgW2Zvb3RlclBhZGRpbmddPVwiKHRoZW1lLm1hcnRGb290ZXJQYWRkaW5nIHx8IERFRkFVTFRTLm1hcnRGb290ZXJQYWRkaW5nKVwiXG4gICAgICBbZGVmYXVsdEFjdGl2ZUVtb109XCInRW1vamknXCJcbiAgICAgIChvbmNoYXJkZWxldGUpPVwiaGFuZGxlQ2hhckRlbGV0ZSgkZXZlbnQpXCJcbiAgICAgIChvbmVtb2NoYW5nZSk9XCJoYW5kbGVFbW9DaGFuZ2UoJGV2ZW50KVwiXG4gICAgICBbbWFydENhdGVnb3J5Rm9udFNpemVdPVwiKHRoZW1lLm1hcnRDYXRlZ29yeUZvbnRTaXplIHx8IERFRkFVTFRTLm1hcnRDYXRlZ29yeUZvbnRTaXplKVwiXG4gICAgICBbbWFydENhdGVnb3J5Q29sb3JdPVwiKHRoZW1lLm1hcnRDYXRlZ29yeUNvbG9yIHx8IERFRkFVTFRTLm1hcnRDYXRlZ29yeUNvbG9yKVwiXG4gICAgICBbbWFydENhdGVnb3J5Q29sb3JBY3RpdmVdPVwiKHRoZW1lLm1hcnRDYXRlZ29yeUNvbG9yQWN0aXZlIHx8IERFRkFVTFRTLm1hcnRDYXRlZ29yeUNvbG9yQWN0aXZlKVwiXG4gICAgICBbYWN0aXZlSW5kaWNhdG9yQ29sb3JdPVwiKHRoZW1lLm1hcnRBY3RpdmVDYXRlZ29yeUluZGljYXRvckNvbG9yIHx8IERFRkFVTFRTLm1hcnRBY3RpdmVDYXRlZ29yeUluZGljYXRvckNvbG9yKVwiXG4gICAgICBbYWN0aXZlSW5kaWNhdG9ySGVpZ2h0XT1cIih0aGVtZS5tYXJ0QWN0aXZlQ2F0ZWdvcnlJbmRpY2F0b3JIZWlnaHQgfHwgREVGQVVMVFMubWFydEFjdGl2ZUNhdGVnb3J5SW5kaWNhdG9ySGVpZ2h0KVwiXG4gICAgICBbZW1vc109XCJlbW9zXCJcbiAgICAgIFtoaWRlRm9vdGVyXT1cImhpZGVGb290ZXJcIj5cbiAgICA8L25neC1lbW9qLWZvb3Rlcj5cblxuICAgIDwvZGl2PlxuICBgLFxuICBzdHlsZXM6IFtgXG5cbiAgICAubmd4LWVtb2ppLW1hcnRcbiAgICB7XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICBtYXJnaW46IDA7XG4gICAgICBtYXJnaW4tYm90dG9tOiAxMHB4O1xuICAgICAgcGFkZGluZzogMHB4O1xuICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgfVxuICBgXVxufSlcblxuXG5leHBvcnQgY2xhc3MgTmd4RW1vakNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgcmVhZG9ubHkgREVGQVVMVFMgPSBERUZBVUxUUztcblxuICBASW5wdXQoKSB3aWR0aDogc3RyaW5nO1xuICBASW5wdXQoKSBoZWlnaHQ6IHN0cmluZztcbiAgQE91dHB1dCgpIG9uZW1vamlwaWNrOiBhbnkgPSBuZXcgRXZlbnRFbWl0dGVyO1xuICBAT3V0cHV0KCkgb25jaGFyZGVsZXRlOiBhbnkgPSBuZXcgRXZlbnRFbWl0dGVyO1xuXG5cbiAgLy8gSW5pdGlhbGx5ICBhcHBseSBkZWZhdWx0IGNvbmZpZy4uLlxuICBASW5wdXQoKSB0aGVtZTogVGhlbWUgPSB7fTtcblxuICBlbW9qaUNhdGVnb3JpZXM6IGFueVtdID0gW107XG5cbiAgLy8gbGlzdCBvZiBlbW9zIHR5cGUsIGUuZyBlbW9qaSwgZ2lmcywgc3RpY2tlcnMuLi5cbiAgZW1vczogYW55IFtdID0gW107XG4gIGFjdGl2ZUNhdGVnb3J5OiBzdHJpbmc7XG4gIGFjdGl2ZUVtbzogc3RyaW5nO1xuICBhY3RpdmVJbmRleDogbnVtYmVyO1xuICBhY3RpdmVFbW9qaVNldDogYW55W107XG4gIGhpZGVGb290ZXI6IEJvb2xlYW4gPSBmYWxzZTtcblxuXG4gIEBJbnB1dCgpIG1heFJlY2VudEVtb2ppOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHJlY2VudEVtb2ppU3RvcmVLZXk6IHN0cmluZztcbiAgQElucHV0KCkgc2VhcmNoRW1vamlQbGFjZWhvbGRlclRleHQ6IHN0cmluZztcbiAgQElucHV0KCkgZW1vamlOb3RGb3VuZFRleHQ6IHN0cmluZztcblxuICBlbW9qaURCOiBhbnk7XG4gIGVtb2ppREJLZXk6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuXG4gICAgLy8gU2V0IHJlY2VudCBlbW9qaSBzdG9yZSBrZXkuLi5cbiAgICB0aGlzLmVtb2ppREJLZXkgID0gdGhpcy5yZWNlbnRFbW9qaVN0b3JlS2V5IHx8IERFRkFVTFRTLnJlY2VudEVtb2ppU3RvcmVLZXk7XG4gICAgLy8gR2V0IHJlY2VudCBlbW9qaXMuLlxuICAgIHRoaXMuZW1vamlEQiA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLmVtb2ppREJLZXkpO1xuICAgIGlmICh0aGlzLmVtb2ppREIpIHtcbiAgICB0aGlzLmVtb2ppREIgPSAgSlNPTi5wYXJzZSh0aGlzLmVtb2ppREIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBubyBzdG9yZWQgcmVjZW50IGVtb2ppLCBzYXZlIGluIHRoZSBzdG9yZSBhcnJheSAuLi5cbiAgICAgIHRoaXMuZW1vamlEQiA9IFtdO1xuICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMuZW1vamlEQktleSwgSlNPTi5zdHJpbmdpZnkodGhpcy5lbW9qaURCKSk7XG4gICAgfVxuXG4gICAgdGhpcy5hY3RpdmVDYXRlZ29yeSA9ICdQZW9wbGUnO1xuICAgIC8vIGdldCB0aGUgZW1vamkgY2F0ZWdvcmllc1xuICAgIHRoaXMuZW1vamlDYXRlZ29yaWVzID0gRU1PSklTLm1hcCgodmFsdWUpID0+IHtcbiAgICAgIHJldHVybiB7bmFtZTogdmFsdWUubmFtZSwgaWNvbjogdmFsdWUuaWNvbn07XG4gICAgfSk7XG5cbiAgICAvLyBmaWx0ZXIgdG8gc2V0IGRlZmF1bHRzXG4gICAgdGhpcy5hY3RpdmVFbW9qaVNldCA9IEVNT0pJUy5maWx0ZXIoKGNhdGVnb3J5KSA9PiB7XG4gICAgICBpZiAoY2F0ZWdvcnkubmFtZSA9PT0gdGhpcy5hY3RpdmVDYXRlZ29yeSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhdGVnb3J5O1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5hY3RpdmVJbmRleCA9IHRoaXMuYWN0aXZlRW1vamlTZXRbMF0uaWQ7XG4gICAgLy8gY29uc29sZS5sb2coJ0luaXRpYWwgRW1vIEluZGV4OicsIHRoaXMuYWN0aXZlSW5kZXgpO1xuICAgIHRoaXMuYWN0aXZlRW1vamlTZXQgPSB0aGlzLmFjdGl2ZUVtb2ppU2V0WzBdLmVtb2ppcztcblxuXG4gICAgdGhpcy5hY3RpdmVFbW8gPSAnRW1vamknO1xuICAgIC8vIGNvbGxhdGUgdGhlIGVtb3MgdHlwZVxuICAgIHRoaXMuZW1vcyA9IEVNT1MubWFwKCh2YWx1ZSkgPT4ge1xuICAgICAgcmV0dXJuIHtuYW1lOiB2YWx1ZS5uYW1lLCBpY29uOiB2YWx1ZS5pY29ufTtcbiAgICB9KTtcbiAgfVxuXG4gIGhhbmRsZUNhdGVnb3J5Q2hhbmdlKGUpIHtcbiAgICAvLyBzZXQgYWN0aXZlIGNhdGVnb3J5IG5hbWUuLi5cbiAgICB0aGlzLmFjdGl2ZUNhdGVnb3J5ID0gZS5uYW1lO1xuXG4gICAgaWYgKGUubmFtZSA9PT0gJ1JlY2VudCcpIHtcbiAgICAgICAgLy8gSWYgcmVjZW50IGNhdGVnb3J5LCBzZXQgZW1vamkgdG8gZW1vamlzIGluIHRoZSByZWNlbnQgc3RvcmUuLi5cbiAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IEVNT0pJU1sxXS5pZDtcbiAgICAgICAgdGhpcy5hY3RpdmVFbW9qaVNldCA9IHRoaXMuZW1vamlEQjtcbiAgICAgIH0gZWxzZSBpZiAoZS5uYW1lID09PSAnU2VhcmNoJykge1xuICAgICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBFTU9KSVNbMF0uaWQ7XG4gICAgICAgICAgdGhpcy5hY3RpdmVFbW9qaVNldCA9IHRoaXMuZW1vamlEQi5jb25jYXQoRU1PSklTWzJdLmVtb2ppcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgLy8gZmlsdGVyIHRvIHNldCBjdXJyZW50IGVtb2ppIHNldC4uLlxuICAgICAgICAgICAgdGhpcy5hY3RpdmVFbW9qaVNldCA9IEVNT0pJUy5maWx0ZXIoKGNhdGVnb3J5KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNhdGVnb3J5Lm5hbWUgPT09IHRoaXMuYWN0aXZlQ2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhdGVnb3J5O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfSk7XG4gICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgaW5kZXggb24gbWFudWFsIGNoYW5nZS4uLlxuICAgICAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IHRoaXMuYWN0aXZlRW1vamlTZXRbMF0uaWQ7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUVtb2ppU2V0ID0gdGhpcy5hY3RpdmVFbW9qaVNldFswXS5lbW9qaXM7XG5cbiAgICAgIH1cbiAgfVxuXG4gIGhhbmRsZUVtb0NoYW5nZShlKSB7XG4gICAgdGhpcy5hY3RpdmVFbW8gPSBlLm5hbWU7XG4gICAgLy8gY29sbGF0ZSB0aGUgZW1vcyB0eXBlXG4gIC8vICAgdGhpcy5lbW9zID0gRU1PUy5tYXAoKHZhbHVlKSA9PiB7XG4gIC8vICAgIHJldHVybiB7bmFtZTogdmFsdWUubmFtZSwgaWNvbjogdmFsdWUuaWNvbn07XG4gIC8vICB9KTtcbiB9XG5cbiBjaGVja0lmRW1vamlFeGlzdHNJbkVtb2ppREIobmFtZSkge1xuICBsZXQgZW1vX2V4aXN0cyA9IGZhbHNlO1xuICAvLyBjaGVja3MgaWYgZW1vamkgaXMgYWxyZWFkeSBpbiByZWNlbnQgZW1vamkgZGIgc3RvcmUuLi5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVtb2ppREIubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodGhpcy5lbW9qaURCW2ldWzFdID09PSBuYW1lKSB7XG4gICAgICBlbW9fZXhpc3RzID0gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBlbW9fZXhpc3RzO1xuXG4gfVxuICBhZGRFbW9qaVRvUmVjZW50RW1vamlEQihlbW9qaTogc3RyaW5nW10pIHtcbiAgICAvLyBjaGVjayBpZiB0aGVyZSBpcyBubyBkdXBsaWNhdGVcbiAgICBpZiAoIXRoaXMuY2hlY2tJZkVtb2ppRXhpc3RzSW5FbW9qaURCKGVtb2ppWzFdKSkge1xuICAgICAgICAvLyByZWNlbnQgZW1vamkgZ3JlYXRlciB0aGFuIHRoZSBudW1iZXIgb2YgbWF4LCByZW1vdmUgdGhlIGZpcnN0IGVtb2ppIGFuZCBhZGQgbmV3IG9uZVxuICAgICAgICAvLyB0byB0aGUgYmFjay4uLlxuICAgICAgICBpZiAodGhpcy5lbW9qaURCLmxlbmd0aCA8ICh0aGlzLm1heFJlY2VudEVtb2ppIHx8IERFRkFVTFRTLm1heFJlY2VudEVtb2ppKSkge1xuICAgICAgICAgIHRoaXMuZW1vamlEQi5wdXNoKGVtb2ppKTtcbiAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5lbW9qaURCS2V5LCBKU09OLnN0cmluZ2lmeSh0aGlzLmVtb2ppREIpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZW1vamlEQi5zcGxpY2UoMCwgMSk7XG4gICAgICAgIHRoaXMuZW1vamlEQi5wdXNoKGVtb2ppKTtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMuZW1vamlEQktleSwgSlNPTi5zdHJpbmdpZnkodGhpcy5lbW9qaURCKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cblxuICBoYW5kbGVFbW9qaVBpY2soZSkge1xuXG4gICAgLy8gc2F2ZSB0aGUgcGlja2VkIGVtb2ppIGluc2lkZSByZWNlbnQgZW1vamkgREJcbiAgICB0aGlzLmFkZEVtb2ppVG9SZWNlbnRFbW9qaURCKGUuZW1vamkpO1xuXG4gICAgdGhpcy5vbmVtb2ppcGljay5lbWl0KHtjaGFyOiBlLmVtb2ppWzBdLCBuYW1lOiBlLmVtb2ppWzFdfSk7XG4gIH1cblxuICBoYW5kbGVDaGFyRGVsZXRlKGUpIHtcbiAgICB0aGlzLm9uY2hhcmRlbGV0ZS5lbWl0KHtkZWxldGVDaGFyOiB0cnVlfSk7XG4gIH1cblxuICBoYW5kbGVDb250ZW50U2Nyb2xsKGUpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnZW1pdHRlZCcsIGUuc2Nyb2xsVG9wLCBlLnNjcm9sbEhlaWdodCk7XG5cbiAgICBpZiAoKGUuc2Nyb2xsSGVpZ2h0IC0gZS5zY3JvbGxUb3ApIDw9IDQwMCkge1xuXG4gICAgICAvLyBjb25zb2xlLmxvZygnYWxtb3N0IGF0IHRoZSBlbmQnKTtcbiAgICAgIHRoaXMuaGlkZUZvb3RlciA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCd0b29waW5nIHRoZSBzY3JvbGwnKTtcbiAgICAgIHRoaXMuaGlkZUZvb3RlciA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUNvbnRlbnRTd2lwZShlKSB7XG4gICAgY29uc3QgY3VycmVudEluZGV4ID0gdGhpcy5hY3RpdmVJbmRleDtcbiAgICBjb25zdCBkaXJlY3Rpb24gPSBlLmRpcmVjdGlvbjtcbiAgICAvLyBMb2cgdGhlIG5lY2Vzc2FyeSBkZXRhaWxzLi4uXG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2xlZnQnKSB7XG4gICAgICBjb25zdCBwcmV2OiBudW1iZXIgPSBjdXJyZW50SW5kZXggLSAxO1xuICAgICAgaWYgKHByZXYgPj0gMCkge1xuXG4gICAgICAgIGlmIChwcmV2ID09PSAwKSB7XG4gICAgICAgICAgLy8gc2VhcmNoXG4gICAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IEVNT0pJU1swXS5pZDtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUNhdGVnb3J5ID0gRU1PSklTWzBdLm5hbWU7XG4gICAgICAgICAgdGhpcy5hY3RpdmVFbW9qaVNldCA9IHRoaXMuZW1vamlEQi5jb25jYXQoRU1PSklTWzJdLmVtb2ppcyk7XG4gICAgICAgIH0gZWxzZSBpZiAocHJldiA9PT0gMSApIHtcbiAgICAgICAgICAvLyByZWNlbnRcbiAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gRU1PSklTWzFdLmlkO1xuICAgICAgICAgIHRoaXMuYWN0aXZlQ2F0ZWdvcnkgPSBFTU9KSVNbMV0ubmFtZTtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUVtb2ppU2V0ID0gdGhpcy5lbW9qaURCO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHByZXZDYXRlZ29yeURhdGEgPSBFTU9KSVMuZmlsdGVyKChjYXRlZ29yeSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjYXRlZ29yeS5pZCA9PT0gcHJldikge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhdGVnb3J5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gc2V0IHRoZSB2YWx1ZXMuLi5cbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBwcmV2O1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVDYXRlZ29yeSA9IHByZXZDYXRlZ29yeURhdGFbMF0ubmFtZTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlRW1vamlTZXQgPSBwcmV2Q2F0ZWdvcnlEYXRhWzBdLmVtb2ppcztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAncmlnaHQnKSB7XG4gICAgICAgIGNvbnN0IG5leHQgPSBjdXJyZW50SW5kZXggKyAxO1xuICAgICAgICBpZiAobmV4dCA9PT0gMCkge1xuICAgICAgICAgIC8vIHNlYXJjaFxuICAgICAgICAgIHRoaXMuYWN0aXZlSW5kZXggPSBFTU9KSVNbMF0uaWQ7XG4gICAgICAgICAgdGhpcy5hY3RpdmVDYXRlZ29yeSA9IEVNT0pJU1swXS5uYW1lO1xuICAgICAgICAgIHRoaXMuYWN0aXZlRW1vamlTZXQgPSB0aGlzLmVtb2ppREIuY29uY2F0KEVNT0pJU1syXS5lbW9qaXMpO1xuICAgICAgICB9IGVsc2UgaWYgKG5leHQgPT09IDEgKSB7XG4gICAgICAgICAgLy8gcmVjZW50XG4gICAgICAgICAgdGhpcy5hY3RpdmVJbmRleCA9IEVNT0pJU1sxXS5pZDtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUVtb2ppU2V0ID0gdGhpcy5lbW9qaURCO1xuICAgICAgICAgIHRoaXMuYWN0aXZlQ2F0ZWdvcnkgPSBFTU9KSVNbMV0ubmFtZTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChuZXh0IDw9IChFTU9KSVMubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2Q2F0ZWdvcnlEYXRhID0gRU1PSklTLmZpbHRlcigoY2F0ZWdvcnkpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChjYXRlZ29yeS5pZCA9PT0gbmV4dCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2F0ZWdvcnk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAvLyBzZXQgdGhlIHZhbHVlcy4uLlxuICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUluZGV4ID0gbmV4dDtcbiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDYXRlZ29yeSA9IHByZXZDYXRlZ29yeURhdGFbMF0ubmFtZTtcbiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVFbW9qaVNldCA9IHByZXZDYXRlZ29yeURhdGFbMF0uZW1vamlzO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxufVxuXG4iXX0=