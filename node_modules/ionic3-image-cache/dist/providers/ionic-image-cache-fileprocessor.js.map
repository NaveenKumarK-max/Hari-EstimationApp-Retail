{"version":3,"file":"ionic-image-cache-fileprocessor.js","sourceRoot":"","sources":["../../src/providers/ionic-image-cache-fileprocessor.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform, Events } from 'ionic-angular';\nimport { Injectable, NgZone } from '@angular/core';\nimport { FileTransfer, FileTransferObject } from '@ionic-native/file-transfer';\nimport { File, FileEntry, RemoveResult, DirectoryEntry } from '@ionic-native/file';\n\n\n@Injectable()\nexport class IonicImageCacheHelperProvider {\n\n  constructor(public event: Events, private transfer: FileTransfer, private file: File, public ngZone: NgZone) {\n\n  }\n\n\n  randomIntFromInterval(min,max)\n  {\n      return Math.floor(Math.random()*(max-min+1)+min);\n  }\n  \n\n  createDir(localFolderPath:string, platform:Platform):Promise<DirectoryEntry>{\n    return new Promise(resolver =>{\n      let targetPath:string = \"\";\n      if (platform.is('ios')) {\n        targetPath = this.file.documentsDirectory;\n      }\n      else if(platform.is('android')) {\n        targetPath = this.file.externalDataDirectory;\n      }\n      this.file.createDir(targetPath, localFolderPath, false).then((directory: DirectoryEntry) => {\n        resolver(directory);\n      }).catch(err =>{\n        resolver(null);\n        console.log(\"Create directory fail\",err);\n      })\n    })    \n  }\n  checkDir(localFolderPath:string, platform:Platform):Promise<boolean>{\n    return new Promise(resolver =>{\n      let targetPath:string = \"\";\n      if (platform.is('ios')) {\n        targetPath = this.file.documentsDirectory;\n      }\n      else if(platform.is('android')) {\n        targetPath = this.file.externalDataDirectory;\n      }\n      this.file.checkDir(targetPath, localFolderPath).then((yesNo: boolean) => {\n        resolver(yesNo);\n      }).catch(err =>{\n        resolver(false);\n        console.log(\"Check directory\",err);\n        this.createDir(localFolderPath, platform);\n      })\n    })    \n  }\n\n  resolveDirectoryUrl(localFolderPath:string, platform:Platform):Promise<DirectoryEntry>{\n    return new Promise(resolver =>{\n      let targetPath:string = \"\";\n      if (platform.is('ios')) {\n        targetPath = this.file.documentsDirectory + localFolderPath;\n      }\n      else if(platform.is('android')) {\n        targetPath = this.file.externalDataDirectory + localFolderPath;\n      }\n\n      // console.log(targetPath);\n      this.file.resolveDirectoryUrl(targetPath).then((dEntry: DirectoryEntry) => {\n        resolver(dEntry);\n      }).catch(err =>{\n        resolver(null);\n        console.log(\"resolveDirectoryUrl\",err);\n        this.createDir(localFolderPath, platform);\n      })\n    })    \n  }\n  \n  clearAllCache(localFolderPath:string, platform:Platform){\n    return new Promise(resolver =>{\n      let targetPath:string = \"\";\n      if (platform.is('ios')) {\n        targetPath = this.file.documentsDirectory;\n      }\n      else if(platform.is('android')) {\n        targetPath = this.file.externalDataDirectory;\n      }\n      this.file.removeRecursively(targetPath, localFolderPath).then((removeResult: RemoveResult) => {\n        resolver(removeResult);\n      }).catch(err =>{\n        console.log(\"Clear directory\",err);\n      })\n    })\n\n  }\n\n  getFilesInFolder(localFolderPath:string, platform:Platform){\n    return new Promise(resolver =>{\n      let targetPath:string = \"\";\n      if (platform.is('ios')) {\n        targetPath = this.file.documentsDirectory;\n      }\n      else if(platform.is('android')) {\n        targetPath = this.file.externalDataDirectory;\n      }\n      this.file.listDir(targetPath, localFolderPath).then((entry: Array<FileEntry>) => {\n        resolver(entry);\n      }).catch(err =>{\n        console.log(\"Get all files in folder \",err);\n      })\n    })\n\n  }\n\n  checkFile(localFolderPath:string, platform:Platform, filename:string){\n    return new Promise(resolver =>{\n      let targetPath:string = \"\";\n      if (platform.is('ios')) {\n        targetPath = this.file.documentsDirectory + localFolderPath;\n      }\n      else if(platform.is('android')) {\n        targetPath = this.file.externalDataDirectory + localFolderPath;\n      }\n      this.file.checkFile(targetPath, filename).then((result: boolean) => {\n        // console.log(\"File exists\");\n        resolver({yesNo: result, fileURL: targetPath + \"/\" + filename});\n      }).catch(err =>{\n        resolver({yesNo: false, fileURL: targetPath + \"/\" + filename});\n        console.log(\"Get if file is availbale \",err);\n      })\n    })\n\n  }\n\n  getFile(DEntry:DirectoryEntry, fileName:string):Promise<FileEntry>{\n    return new Promise(resolver =>{\n      this.file.getFile(DEntry, fileName,{ create: false }).then((entry: FileEntry) => {\n        // console.log(\"File exists\");\n        resolver(entry);\n      }).catch(err =>{\n        resolver(null);\n        console.log(\"Get file failed \",fileName,err);\n      })\n    })\n\n  }\n\n  extractPath(remoteURL:string, asFilename:boolean = true){\n    let path:string = (new URL(remoteURL)).pathname\n    if(asFilename){\n      path = this.replace(\"/\",\"\",path);\n      path = this.replace(\" \",\"\",path);\n    }\n    // console.log(path);\n    return path;\n  }\n\n  ValidURL(str:string):boolean {\n    let result:boolean = str == undefined ? false : ((str.indexOf(\"http://\") > -1 || str.indexOf(\"https://\") > -1) && str.indexOf(\"data:image/\") < 0);\n    // console.log(result, str);\n    return result;\n  }\n\n  downloadImage(fileurl:string, platform:Platform, localFolderPath: string = \"cache_assets\", trustAll:boolean = true){\n    return new Promise(resolver =>{\n      const fileTransfer: FileTransferObject = this.transfer.create();\n    \n      let ext = fileurl.split('.').pop();\n      let prog:number = 0;\n      let targetPath:string = \"\";\n  \n      //android fix\n      let fpath = this.extractPath(fileurl);\n      if(fpath.split('.').pop().length < 2){\n        fpath = fpath + \".\" + ext;\n      }\n  \n      if (platform.is('ios')) {\n        // console.log(\"saving to IOS\");\n        targetPath = this.file.documentsDirectory + localFolderPath + \"/\" + fpath;\n      }\n      else if(platform.is('android')) {\n        targetPath = this.file.externalDataDirectory + localFolderPath + \"/\" + fpath;\n      }\n  \n      fileTransfer.download(fileurl,targetPath,trustAll).then((entry:FileEntry) => {\n        resolver(entry);\n      }, (error) => {\n        // handle error\n        console.log(error);\n        throw error;\n      })\n      fileTransfer.onProgress((listener)=> {\n        this.ngZone.run(()=>{\n          let tempprog = Math.round(((listener.loaded / listener.total) * 100));\n          if(tempprog > prog){\n  \n            this.event.publish('ionicImageCacheprogressCounter', tempprog); \n            prog = tempprog;         \n          }\n  \n        })                \n        \n      })\n    });\n\n  }\n\n  addHours(date:Date, hours:number):Date{\n    date.setHours(date.getHours()+hours);\n    return date;\n  }\n\n  addMinutes(date:Date, minutes:number):Date{\n    date.setMinutes(date.getMinutes()+minutes);\n    return date;\n  }\n\n  safeiOSNativeURL(url:string):string{\n    let finalURL = url.replace(/^file:\\/\\//, '');\n    return finalURL;\n  }\n\n  escapeRegExp(str) {\n    return str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n  }\n  replace(find,replace,fullstr){\n    return fullstr.replace(new RegExp(this.escapeRegExp(find), 'g'), replace);\n  }\n\n  getFilename(url, withExt:boolean = true):string{\n    let fileName: string = url.substring(url.lastIndexOf('/')+1);\n    let ext = \".\" + url.split('.').pop();\n    return withExt ? fileName : `${fileName.replace(ext,\"\")}`;\n  }\n\n  getFileExtentions(url):string{\n    return url.split('.').pop();\n  }\n\n}\n"]}